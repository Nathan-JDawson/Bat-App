<!DOCTYPE html>
<html lang="en">
<head>
    <title>Exterior</title>
    <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="stylesheet.css">
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.0/jquery.validate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/jquery.validation/1.15.0/additional-methods.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="functions.js" type="text/javascript"></script>
    <script>
        jQuery(document).ready(() => {
            $("#buttons").load("buttons.html");
            $("#back_button").load("back.html");
            $("#image_upload").load("image_upload.html");
            $("#bat_wall_evidence_div").load("bat_evidence_options.html");

            $("input[name = walls]").change(() => {
                if($("#walls_yes").is(":checked")){
                    $("#walls_present").show();
                }else{
                    $("#walls_present").hide();
                }
            })

            // set up validation for the forms - uses jQuery Validate plugin
            let select_message = "Please select an option"
            $("#location_form").validate({
                
            })

            // need to use function here rather than => as 'this' is used
            $("#buttons").on("click", ":button", function () {
                let valid = true;
                if (valid){
                    array = generate_array();
                    console.log(array);
                    send_data(array);
                    if ($(this).attr("id") === "button_1") {
                        window.location.replace("/client_details");
                    } else if ($(this).attr("id") === "button_2") {
                        generate_report();
                    } else if ($(this).attr("id") === "button_3") {
                        window.open('/download_report');
                    }
                }
            })

            // adds/removes promts for photos when materials are (un)checked
            $("#checkboxes").on("change", ":checkbox", function(){
                let name = $(this).attr("name");
                if($(this).is(":checked")){
                    let html = `<li id='p_${name}'>Add photo of ${name} wall</li>`;
                    $("#images_promts").append(html);
                }else
                    $(`#p_${name}`).remove();
            })

            // add/removes promts for photos when cracks are marked as present
            $("input[type=radio][name=cracks]").change(function(){
                $("#p_cracks").remove();
                if($(this).val() !== "none"){
                    let html = "<li id=p_cracks>Add photo of cracks in walls</li>";
                    $("#images_promts").append(html);
                }
            })

            // add prompts based on evidence added
            $("#bat_wall_evidence_div").on("change", ".bat_wall_evidence", function(){
                let num = $(this).parents(".add_evidence").attr("id");
                $(`#p_${num}`).remove();
                let evidence = $(this).val().replace("_", " ");
                if(evidence){
                    let html = `<li id='p_${num}'>Add photo of ${evidence} evidence</li>`;
                    $("#images_promts").append(html);
                }
            })

            $("#images_promts").on("click", "li", function(){
                $(this).css("text-decoration", "line-through");
            })

            const generate_filenames = () => {
                // select all filename elements - put in array
                let filenames = $(".filename");
                let filenames_array = [];
                filenames.map((index, element) => {
                    if($(element).val())
                        filenames_array.push($(element).val());
                })

                return filenames_array;
            }

            const generate_captions = () => {
                let images = $(".preview").attr("src");
                console.log(images);

                let captions = $(".caption");
                let captions_array = [];
                captions.map((index, element) => {
                    if($(element).val())
                        captions_array.push($(element).val());
                })

                return captions_array;
            }

            // captures the form into an array/object
            const generate_array = () => {
                let filenames_array = generate_filenames();
                let captions_array = generate_captions();

                let array = {
                        filenames: filenames_array,
                        captions: captions_array
                    };

                return array;
            }
        });
    </script>
    <style>
        .panel-title[aria-expanded=false] .glyphicon-chevron-up{
            display: none;
        }
        .panel-title[aria-expanded=true] .glyphicon-chevron-down{
            display: none;
        }
        .panel-heading{
            cursor: pointer;
        }
        .vcenter{
            display: flex;
            align-items: center;
            text-align: center;
        }
        li{
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <h1 class="text-center">Exterior</h1>
        <div id="back_button"></div>
        <br>
        <!--
                Values Needed:
                Walls
                    Material
                    Condition
                    Features
                    Evidence
                    Potential
                Roof
                    Form
                    Material
                    Watertight?
                    Condition
                    Features
                        Description
                        Evidence
                        Potential
                Entrances
                    Windows
                        Condition
                        Matieral
                        Features
                        Evidence
                        Potential
                    Doorways
                        Condition
                        Material
                        Features
                        Evidence
                        Potential
            -->
        <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title" aria-expanded="false" data-parent="#accordion" data-toggle="collapse" data-target="#walls_collapse">
                        Walls
                        <span style="float: right;" class="glyphicon glyphicon-chevron-down" aria-hidden="true"></span>
                        <span style="float: right;" class="glyphicon glyphicon-chevron-up" aria-hidden="true"></span>
                    </h3>
                </div>
                <div id="walls_collapse" class="panel-collapse collapse in">
                    <div class="panel-body">
                        <form id="walls_form">
                            <div class="row">
                                <div class="col-xs-6">
                                    <label>Are walls present?</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="radio">
                                        <label><input type="radio" id="walls_yes" name="walls">Yes</label>
                                        <label><input type="radio" id="walls_no" name="walls" checked>No</label>
                                    </div>
                                </div>
                            </div>
                            <div id="walls_present" hidden>
                                <div class="row">
                                    <label class="col-xs-12">
                                        The walls comprised of...
                                    </label>
                                </div>
                                <div id="checkboxes">
                                    <div class="row">
                                        <div class="checkbox">
                                            <div class="col-xs-3">
                                                <label><input type="checkbox" id="brick" name="brick">Brick</label>
                                            </div>
                                            <div class="col-xs-3">
                                                <label><input type="checkbox" id="stone" name="stone">Stone</label>
                                            </div>
                                            <div class="col-xs-3">
                                                <label><input type="checkbox" id="timber" name="timber">Timber</label>
                                            </div>
                                            <div class="col-xs-3">
                                                <label><input type="checkbox" id="steel" name="steel">Steel</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="checkbox">
                                            <div class="col-xs-3">
                                                <label><input type="checkbox" id="render" name="render">Render</label>
                                            </div>
                                            <div class="col-xs-3">
                                                <label><input type="checkbox" id="cladding" name="cladding">Cladding</label>
                                            </div>
                                            <div class="col-xs-3">
                                                <label><input type="checkbox" id="block" name="block">Block</label>
                                            </div>
                                            <div class="col-xs-3">
                                                <label><input type="checkbox" id="shiplap" name="shiplap">Shiplap</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="checkbox">
                                            <div class="col-xs-4">
                                                <label><input type="checkbox" id="hanging tiles" name="hanging tiles">Hanging Tiles</label>
                                            </div>
                                            <div class="col-xs-4">
                                                <label><input type="checkbox" id="weatherboarding" name="weatherboarding">Weatherboarding</label>
                                            </div>
                                            <div class="col-xs-4">
                                                <label><input type="checkbox" id="waney lap" name="waney lap">Waney Lap</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <br>
                                <div class="row">
                                    <div class="col-xs-12">
                                        <select class="form-control" id="wall_condition" name="wall_condition">
                                            <option value="" selected>Condition...</option>
                                            <option value="good">Good</option>
                                            <option value="moderate">Moderate</option>
                                            <option value="poor">Poor</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row vcenter">
                                    <label class="col-xs-3"></label>
                                    <label class="col-xs-2">None</label>
                                    <label class="col-xs-2">Some</label>
                                    <label class="col-xs-2">Several</label>
                                    <label class="col-xs-2">Many</label>
                                </div>
                                <div class="row">
                                    <div class="form-group vcenter" id="cracks_select">
                                        <label class="col-xs-3">Cracks</label>
                                        <div class="col-xs-2">
                                            <input type="radio" class="form-control" name="cracks" value="none" checked>
                                        </div>
                                        <div class="col-xs-2">
                                            <input type="radio" class="form-control" name="cracks" value="some">
                                        </div>
                                        <div class="col-xs-2">
                                            <input type="radio" class="form-control" name="cracks" value="several">
                                        </div>
                                        <div class="col-xs-2">
                                            <input type="radio" class="form-control" name="cracks" value="many">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-6">
                                        <label>Evidence of bats found?</label>
                                    </div>
                                </div>
                                <div id="bat_wall_evidence_div">
                                    <!-- load in evidence elements -->
                                </div>
                                <div class="row">
                                    <div class="col-xs-12">
                                        <label>Photo Upload (Click list items to cross off)</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-12">
                                        <ul id="images_promts"></ul>
                                    </div>
                                </div>
                                <!-- Upload photo of evidence, allow caption to be added -->
                                <div id="image_upload"></div>
                                <br>
                                <div class="row">
                                    <div class="col-xs-12">
                                        <select class="form-control" id="walls_potential" name="walls_potential">
                                            <option value="">Bat Potential...</option>
                                            <option value="high">High</option>
                                            <option value="medium">Medium</option>
                                            <option value="low">Low</option>
                                            <option value="negligible">Negligible</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" id="buttons">
            <!-- buttons.html will be loaded here -->
        </div>
    </div>
</body>
</html>