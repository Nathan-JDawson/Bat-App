<script>
    $(".btn_image").click(function(){
        $(this).parent().find(".image").trigger("click");
    })

    $(".image").change(function(){
        let id = $(this).attr("id");
        let fd = new FormData(), file = $(this).prop("files")[0];
        fd.append("upload", file)
        $.ajax({
            type: "POST",
            url: "compress_image",
            data: fd,
            contentType: false,
            processData: false,
            success: function (data) {
                $("#filename_" + id).val(data.imageName)
                let img = document.createElement("IMG");
                img.setAttribute("id", "preview_img");
                img.setAttribute("class", "img-responsive img-rounded")
                img.src = data.imageUrl;
                img.alt = "image preview";
                $("#preview_" + id).html(img);
                $("#caption_div_" + id).show();
            },
            error: function (err) {
                console.error(err)
            }
        });
    })

    let i_num = 0;

    $("#add_more_images").click(() => {
        i_num += 1;
        $("#div_0").clone().prop("id", "div_" + i_num).appendTo($("#walls_image_upload")).show();
    })

    $("#remove_image").click(() => {
        i_num -= 1;
        $(".photo_upload").last().remove();
    })
</script>
<style>
    .preview_img{
        max-height: 300px;
    }
    .image{
        width: 0.1px;
        height: 0.1px;
        opacity: 0;
        position: absolute;
        overflow: hidden;
        z-index: -1;
    }
</style>
<div id="walls_image_upload">
    <div class="photo_upload" class="form-group" id="div_0" hidden>
        <div class="row">
            <div class="col-xs-3">
                <button type="button" class="btn btn-default btn_image">Browse...</button>
                <input type="file" class="image" id="0">
            </div>
            <div class="col-xs-9">
                <input type="text" class="form-control" id="filename_0" readonly>
            </div>
        </div>
        <div class="img_and_caption">
            <div class="row">
                <div class="col-xs-12">
                    <div id="preview_0"></div>
                </div>
            </div>
            <div class="row" id="caption_div_0" hidden>
                <div class="col-xs-8">
                    <label>Image Caption:</label>
                </div>
                <div class="col-xs-12">
                    <input type="text" class="form-control caption" placeholder="Caption...">
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-xs-6">
        <button type="button" class="btn btn-success" id="add_more_images">Add Another Image</button>
    </div>
    <div class="col-xs-6">
        <button type="button" class="btn btn-danger" id="remove_image">Remove Last Image</button>
    </div>
</div>
